{% load static %}

<script id="nav-data" type="application/json">{{ navigation_items_json|safe|default:'[]' }}</script>

<div x-data="{
    isScrolled: false,
    activeMenu: null,
    isMobileMenuOpen: false,
    topBarLinks: [
        { label: 'Publications', href: '/publications' },
        { label: 'International Students', href: '/admission/international' },
        { label: 'Academic Calendar', href: '/academic/calendar' },
        { label: 'Library', href: '/library' },
        { label: 'Newsletters', href: '/newsletters' },
        { label: 'Journals', href: '/research/journals' },
        { label: 'Catalog', href: '/catalog' },
        { label: 'Archive', href: '/archive' },
        { label: 'Contact Us', href: '/contact' }
    ],
    navigationItems: JSON.parse(document.getElementById('nav-data').textContent),
    toggleMenu(label) {
        this.activeMenu = this.activeMenu === label ? null : label;
    },
    closeMenu() {
        this.activeMenu = null;
    }
}" 
x-init="window.addEventListener('scroll', () => { isScrolled = window.scrollY > 100 })"
@keydown.escape.window="activeMenu = null; isMobileMenuOpen = false"
class="relative z-[100]">

    <!-- Sticky Header Wrapper -->
    <div class="w-full transition-all duration-300"
         :class="isScrolled ? 'fixed top-0 left-0 w-full animate-slideDown z-50' : 'relative z-40'">
        
        <!-- Top Bar -->
        <template x-if="!isScrolled">
            {% include 'partials/layout/top_bar.html' %}
        </template>

        <div class="relative" :class="isScrolled ? 'header-scrolled' : 'header-glass'">
            <div class="max-w-[1200px] mx-auto px-6 lg:px-8">
                <div class="flex items-center justify-between h-[60px] lg:h-[70px]">
                    
                    <!-- Logo -->
                    <div class="relative z-10 shrink-0 group">
                        <a href="/" class="block">
                            <img src="https://www.northsouth.edu/newassets/summer_25/img/logo.png" 
                                 alt="North South University"
                                 class="object-contain w-[45px] h-[45px] lg:w-[130px] lg:h-[60px] transition-all duration-300 group-hover:drop-shadow-[0_0_15px_rgba(0,81,255,0.4)]" />
                        </a>
                    </div>

                    <!-- Desktop Navigation -->
                    <nav class="hidden lg:flex items-center justify-center flex-1 text-white text-[14px] font-[500] tracking-wide">
                        <template x-for="item in navigationItems" :key="item.label">
                            <div class="nav-link-underline flex items-center cursor-pointer px-4 py-2 mx-0.5 rounded-md transition-all duration-200 select-none"
                                 :class="activeMenu === item.label ? 'bg-[var(--primary)]/20 text-white' : 'hover:bg-white/5'"
                                 @click="item.hasDropdown ? toggleMenu(item.label) : (window.location.href = item.href)"
                                 @mouseenter="item.hasDropdown && activeMenu !== null ? (activeMenu = item.label) : null">
                                
                                <span x-text="item.label" class="font-semibold"></span>
                                
                                <template x-if="item.hasDropdown">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                         class="ml-1.5 opacity-70 transition-transform duration-300"
                                         :class="activeMenu === item.label ? 'rotate-180' : ''"><path d="m6 9 6 6 6-6"/></svg>
                                </template>
                            </div>
                        </template>
                    </nav>

                    <!-- Apply Now CTA -->
                    <div class="hidden lg:block">
                        <a href="/contact-us/" class="btn-primary-blue text-[13px] px-5 py-2.5 rounded-md">
                            <span class="flex items-center">
                                <i data-lucide="pen-line" class="w-3.5 h-3.5 mr-2"></i>
                                Apply Now
                            </span>
                        </a>
                    </div>

                    <!-- Mobile Navigation Toggle Button -->
                    {% include 'partials/layout/mobile_nav_toggle.html' %}

                </div>
            </div>

            <!-- Mega Menu -->
            {% include 'partials/layout/mega_menu.html' %}
        </div>
    </div>

    <!-- Mobile Navigation Menu Content (Overlay & Panel) -->
    {% include 'partials/layout/mobile_nav_menu.html' %}
</div>
