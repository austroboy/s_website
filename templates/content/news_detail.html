{% extends 'base.html' %}
{% load static %}

{% block title %}{{ news_item.title }} | {{ request.tenant.name|default:"School Name" }}{% endblock %}

{% block content %}
<!-- Standard Academic Hero Header matching Department/Programs -->
{% include 'partials/academic/header.html' with page_title="Institutional News" %}

<article class="py-12 md:py-20 bg-white relative overflow-hidden">
    <div class="max-w-[1240px] mx-auto px-6 lg:px-8 relative z-10 reveal-up">
        
        <div class="flex flex-col lg:flex-row gap-12">
            
            <!-- Main Content Area (70%) -->
            <div class="lg:w-[70%]">
                <!-- Article Header (Title First) -->
                <header class="mb-8">
                    <h1 class="text-3xl md:text-5xl font-extrabold text-[var(--secondary)] tracking-tight leading-tight mb-4">
                        {{ news_item.title }}
                    </h1>
                    
                    <div class="flex flex-wrap items-center gap-6 text-[var(--text-muted)] font-bold text-base border-b border-gray-100 pb-8">
                        <span class="flex items-center gap-2">
                            <i data-lucide="calendar" class="w-5 h-5 text-[var(--primary)]"></i> 
                            {{ news_item.date }}
                        </span>
                        <span class="flex items-center gap-2">
                            <i data-lucide="user" class="w-5 h-5 text-[var(--primary)]"></i> 
                            By {{ news_item.author }}
                        </span>
                    </div>
                </header>

                <!-- Dynamic Image Presentation (Carousel) -->
                {% if news_item.images %}
                <div class="relative w-full h-[350px] md:h-[500px] rounded-2xl overflow-hidden shadow-lg mb-12 bg-gray-50 border border-gray-100" 
                     x-data="{ 
                         activeSlide: 0, 
                         images: [
                             {% for image in news_item.images %}
                             { url: '{{ image.url }}', alt: '{{ image.alt }}' }{% if not forloop.last %},{% endif %}
                             {% endfor %}
                         ],
                         next() { this.activeSlide = (this.activeSlide + 1) % this.images.length },
                         prev() { this.activeSlide = (this.activeSlide - 1 + this.images.length) % this.images.length }
                     }">
                    
                    <!-- Slides -->
                    <template x-for="(img, index) in images" :key="index">
                        <div class="absolute inset-0 transition-opacity duration-1000"
                             :class="activeSlide === index ? 'opacity-100 z-10' : 'opacity-0 z-0'">
                            <img :src="img.url" :alt="img.alt" class="w-full h-full object-cover">
                        </div>
                    </template>
                    
                    <!-- Basic Next/Prev Buttons (Conditional) -->
                    <template x-if="images.length > 1">
                        <div class="absolute inset-0 z-20 flex items-center justify-between p-4 pointer-events-none">
                            <button @click="prev" class="pointer-events-auto bg-black/30 hover:bg-black/60 text-white p-3 rounded-full backdrop-blur-md transition-all shadow-lg">
                                <i data-lucide="chevron-left" class="w-6 h-6"></i>
                            </button>
                            <button @click="next" class="pointer-events-auto bg-black/30 hover:bg-black/60 text-white p-3 rounded-full backdrop-blur-md transition-all shadow-lg">
                                <i data-lucide="chevron-right" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </template>

                    <!-- Counter Indicator -->
                    <template x-if="images.length > 1">
                        <div class="absolute bottom-6 right-6 z-20 bg-black/50 backdrop-blur-md text-white text-[10px] font-bold px-3 py-1.5 rounded-full tracking-widest uppercase">
                            <span x-text="activeSlide + 1"></span> / <span x-text="images.length"></span>
                        </div>
                    </template>
                </div>
                {% endif %}

                <!-- Article Body -->
                <div class="prose prose-lg max-w-none text-[var(--text-muted)] leading-relaxed prose-headings:text-[var(--secondary)] prose-a:text-[var(--primary)] prose-blockquote:border-l-[var(--primary)] prose-blockquote:bg-[var(--surface-alt)] prose-blockquote:py-2 prose-blockquote:px-6 prose-blockquote:rounded-r-xl prose-blockquote:italic">
                    {{ news_item.contentHtml|safe }}
                </div>
            </div>

            <!-- Sidebar Area (30%) -->
            <aside class="lg:w-[30%] space-y-8">
                <!-- What's Happening Sidebar (News) -->
                <div class="bg-white p-6 md:p-8 rounded-3xl border border-gray-100 shadow-sm reveal-up">
                    <div class="flex items-center space-x-3 mb-8">
                        <div class="bg-gradient-to-br from-[var(--accent)] to-[var(--accent-dark)] p-2 rounded-xl text-white shadow-lg">
                            <i data-lucide="zap" class="w-4 h-4"></i>
                        </div>
                        <h2 class="text-xl font-extrabold text-[var(--text)] tracking-tight">What's Happening</h2>
                    </div>

                    <div class="space-y-6">
                        {% for item in news_events %}
                        <a href="{{ item.href }}" class="group flex flex-col space-y-3">
                            <div class="relative h-32 rounded-2xl overflow-hidden shadow-sm">
                                <img src="{{ item.image }}" alt="{{ item.title }}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                <div class="absolute bottom-3 left-3 flex flex-col w-10 shadow-lg rounded-lg overflow-hidden translate-y-1 group-hover:translate-y-0 transition-transform">
                                    <div class="bg-white text-[var(--secondary)] font-extrabold text-center py-1 text-sm leading-tight">{{ item.day }}</div>
                                    <div class="bg-gradient-to-r from-[var(--primary)] to-[var(--primary-dark)] text-white font-bold text-center py-0.5 text-[8px] uppercase tracking-wider">{{ item.month }}</div>
                                </div>
                            </div>
                            <h4 class="text-[13px] font-bold text-[var(--text)] leading-snug group-hover:text-[var(--primary)] transition-colors line-clamp-2">
                                {{ item.title }}
                            </h4>
                        </a>
                        {% endfor %}
                    </div>

                    <div class="mt-8 border-t border-gray-50 pt-6">
                        <a href="{% url 'content:news_list' %}" class="flex items-center justify-center text-[10px] font-black text-[var(--primary)] hover:text-[var(--primary-dark)] transition-colors uppercase tracking-[0.2em]">
                            View All News
                            <i data-lucide="arrow-up-right" class="w-3 h-3 ml-2"></i>
                        </a>
                    </div>
                </div>

                <!-- Recent Highlights Sidebar (Notices) -->
                <div class="bg-[var(--surface-alt)] p-6 md:p-8 rounded-3xl border border-gray-100 shadow-sm reveal-up sticky top-24">
                    <div class="flex items-center space-x-3 mb-8">
                        <div class="bg-gradient-to-br from-[var(--primary)] to-[var(--primary-dark)] p-2 rounded-xl text-white shadow-lg">
                            <i data-lucide="bell" class="w-4 h-4"></i>
                        </div>
                        <h2 class="text-xl font-extrabold text-[var(--text)] tracking-tight">Recent Highlights</h2>
                    </div>

                    <div class="space-y-4">
                        {% for item in recent_notices %}
                        <a href="{{ item.href }}" class="group flex items-stretch bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 border border-gray-100 hover:border-[var(--primary)]/30 overflow-hidden">
                            <!-- Mini Date -->
                            <div class="w-16 flex-shrink-0 bg-gradient-to-b from-[var(--primary)] to-[var(--primary-dark)] flex flex-col items-center justify-center py-2 text-white">
                                <span class="text-sm font-extrabold leading-tight">{{ item.date|slice:":2" }}</span>
                                <span class="text-[8px] font-bold uppercase tracking-wider opacity-80">{{ item.date|slice:"3:" }}</span>
                            </div>
                            <!-- Content -->
                            <div class="flex-1 p-3 flex flex-col justify-center min-w-0">
                                <h4 class="text-[12px] font-bold text-[var(--text)] leading-snug group-hover:text-[var(--primary)] transition-colors line-clamp-2">
                                    {{ item.title }}
                                </h4>
                            </div>
                        </a>
                        {% endfor %}
                    </div>

                    <div class="mt-8">
                        <a href="{% url 'content:notice_list' %}" class="block text-center text-xs font-bold text-[var(--primary)] hover:text-[var(--primary-dark)] transition-colors uppercase tracking-widest border border-[var(--primary)]/30 py-3 rounded-xl hover:bg-white">
                            View All Notices
                        </a>
                    </div>
                </div>
            </aside>

        </div>
    </div>
</article>
{% endblock %}
